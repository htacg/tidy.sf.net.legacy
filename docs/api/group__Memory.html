<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HTML Tidy: Memory Allocation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<h1>Memory Allocation</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__TidyAllocatorVtbl.html">_TidyAllocatorVtbl</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__TidyAllocator.html">_TidyAllocator</a></td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__TidyAllocatorVtbl.html">_TidyAllocatorVtbl</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g3fe8c5ac7d658618c732565776940ed8">TidyAllocatorVtbl</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct__TidyAllocator.html">_TidyAllocator</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g78e96524a88db0c09e766795265863da">TidyAllocator</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef void *(TIDY_CALL *)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g5d9e7a9022c9cc63afd3d7a42f7db73e">TidyMalloc</a> (size_t len)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef void *(TIDY_CALL *)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g4e3ecd3a3aa89d95e3b5e22ba4030deb">TidyRealloc</a> (void *buf, size_t len)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef void(TIDY_CALL *)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g4a092275b1ca47e289ca3b9c40da889a">TidyFree</a> (void *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef void(TIDY_CALL *)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g78ac70ebd3df410e89f6a77f5e8a376a">TidyPanic</a> (ctmbstr mssg)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool TIDY_CALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#gb55079374527525e3374ebc4d2a1e625">tidySetMallocCall</a> (<a class="el" href="group__Memory.html#g5d9e7a9022c9cc63afd3d7a42f7db73e">TidyMalloc</a> fmalloc)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool TIDY_CALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g446b538da3ee3f2e5a3827b877665b30">tidySetReallocCall</a> (<a class="el" href="group__Memory.html#g4e3ecd3a3aa89d95e3b5e22ba4030deb">TidyRealloc</a> frealloc)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool TIDY_CALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#g70e707b7df86effb5727b0b9ff64eed7">tidySetFreeCall</a> (<a class="el" href="group__Memory.html#g4a092275b1ca47e289ca3b9c40da889a">TidyFree</a> ffree)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool TIDY_CALL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Memory.html#gb12cc0435bacec1a8c725e02357acc00">tidySetPanicCall</a> (<a class="el" href="group__Memory.html#g78ac70ebd3df410e89f6a77f5e8a376a">TidyPanic</a> fpanic)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Tidy uses a user provided allocator for all memory allocations. If this allocator is not provided, then a default allocator is used which simply wraps standard C malloc/free calls. These wrappers call the panic function upon any failure. The default panic function prints an out of memory message to stderr, and calls exit(2).<p>
For applications in which it is unacceptable to abort in the case of memory allocation, then the panic function can be replaced with one which longjmps() out of the tidy code. For this to clean up completely, you should be careful not to use any tidy methods that open files as these will not be closed before panic() is called.<p>
TODO: associate file handles with tidyDoc and ensure that tidyDocRelease() can close them all.<p>
Calling the withAllocator() family ( tidyCreateWithAllocator, tidyBufInitWithAllocator, tidyBufAllocWithAllocator) allow settings custom allocators).<p>
All parts of the document use the same allocator. Calls that require a user provided buffer can optionally use a different allocator.<p>
For reference in designing a plug-in allocator, most allocations made by tidy are less than 100 bytes, corresponding to attribute names/values, etc.<p>
There is also an additional class of much larger allocations which are where most of the data from the lexer is stored. (It is not currently possible to use a separate allocator for the lexer, this would be a useful extension).<p>
In general, approximately 1/3rd of the memory used by tidy is freed during the parse, so if memory usage is an issue then an allocator that can reuse this memory is a good idea. <hr><h2>Typedef Documentation</h2>
<a class="anchor" name="g3fe8c5ac7d658618c732565776940ed8"></a><!-- doxytag: member="tidy.h::TidyAllocatorVtbl" ref="g3fe8c5ac7d658618c732565776940ed8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__TidyAllocatorVtbl.html">_TidyAllocatorVtbl</a> <a class="el" href="struct__TidyAllocatorVtbl.html">TidyAllocatorVtbl</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The allocators function table 
</div>
</div><p>
<a class="anchor" name="g78e96524a88db0c09e766795265863da"></a><!-- doxytag: member="tidy.h::TidyAllocator" ref="g78e96524a88db0c09e766795265863da" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__TidyAllocator.html">_TidyAllocator</a> <a class="el" href="struct__TidyAllocator.html">TidyAllocator</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The allocator 
</div>
</div><p>
<a class="anchor" name="g5d9e7a9022c9cc63afd3d7a42f7db73e"></a><!-- doxytag: member="tidy.h::TidyMalloc" ref="g5d9e7a9022c9cc63afd3d7a42f7db73e" args="(size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void*(TIDY_CALL *) <a class="el" href="group__Memory.html#g5d9e7a9022c9cc63afd3d7a42f7db73e">TidyMalloc</a>(size_t len)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback for "malloc" replacement 
</div>
</div><p>
<a class="anchor" name="g4e3ecd3a3aa89d95e3b5e22ba4030deb"></a><!-- doxytag: member="tidy.h::TidyRealloc" ref="g4e3ecd3a3aa89d95e3b5e22ba4030deb" args="(void *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void*(TIDY_CALL *) <a class="el" href="group__Memory.html#g4e3ecd3a3aa89d95e3b5e22ba4030deb">TidyRealloc</a>(void *buf, size_t len)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback for "realloc" replacement 
</div>
</div><p>
<a class="anchor" name="g4a092275b1ca47e289ca3b9c40da889a"></a><!-- doxytag: member="tidy.h::TidyFree" ref="g4a092275b1ca47e289ca3b9c40da889a" args="(void *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(TIDY_CALL *) <a class="el" href="group__Memory.html#g4a092275b1ca47e289ca3b9c40da889a">TidyFree</a>(void *buf)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback for "free" replacement 
</div>
</div><p>
<a class="anchor" name="g78ac70ebd3df410e89f6a77f5e8a376a"></a><!-- doxytag: member="tidy.h::TidyPanic" ref="g78ac70ebd3df410e89f6a77f5e8a376a" args="(ctmbstr mssg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(TIDY_CALL *) <a class="el" href="group__Memory.html#g78ac70ebd3df410e89f6a77f5e8a376a">TidyPanic</a>(ctmbstr mssg)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback for "out of memory" panic state 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gb55079374527525e3374ebc4d2a1e625"></a><!-- doxytag: member="tidy.h::tidySetMallocCall" ref="gb55079374527525e3374ebc4d2a1e625" args="(TidyMalloc fmalloc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool TIDY_CALL tidySetMallocCall           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__Memory.html#g5d9e7a9022c9cc63afd3d7a42f7db73e">TidyMalloc</a>&nbsp;</td>
          <td class="paramname"> <em>fmalloc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Give Tidy a malloc() replacement 
</div>
</div><p>
<a class="anchor" name="g446b538da3ee3f2e5a3827b877665b30"></a><!-- doxytag: member="tidy.h::tidySetReallocCall" ref="g446b538da3ee3f2e5a3827b877665b30" args="(TidyRealloc frealloc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool TIDY_CALL tidySetReallocCall           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__Memory.html#g4e3ecd3a3aa89d95e3b5e22ba4030deb">TidyRealloc</a>&nbsp;</td>
          <td class="paramname"> <em>frealloc</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Give Tidy a realloc() replacement 
</div>
</div><p>
<a class="anchor" name="g70e707b7df86effb5727b0b9ff64eed7"></a><!-- doxytag: member="tidy.h::tidySetFreeCall" ref="g70e707b7df86effb5727b0b9ff64eed7" args="(TidyFree ffree)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool TIDY_CALL tidySetFreeCall           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__Memory.html#g4a092275b1ca47e289ca3b9c40da889a">TidyFree</a>&nbsp;</td>
          <td class="paramname"> <em>ffree</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Give Tidy a free() replacement 
</div>
</div><p>
<a class="anchor" name="gb12cc0435bacec1a8c725e02357acc00"></a><!-- doxytag: member="tidy.h::tidySetPanicCall" ref="gb12cc0435bacec1a8c725e02357acc00" args="(TidyPanic fpanic)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool TIDY_CALL tidySetPanicCall           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__Memory.html#g78ac70ebd3df410e89f6a77f5e8a376a">TidyPanic</a>&nbsp;</td>
          <td class="paramname"> <em>fpanic</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Give Tidy an "out of memory" handler 
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue Jan 23 10:43:44 2007 for HTML Tidy by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
